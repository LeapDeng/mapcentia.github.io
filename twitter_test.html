<!DOCTYPE html>
<html lang="en">
	<head>
		<title>PGRounting</title>
		<meta charset="UTF-8"/>
		<link href="http://netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css"type="text/css" rel="stylesheet">	
		<link href="http://us1.mapcentia.com/js/Leaflet.awesome-markers/dist/leaflet.awesome-markers.css" type="text/css" rel="stylesheet">

	</head>
	<body>
		<div id="map" style="width:700px;height:700px"></div>
	</body>
	<script src='http://eu1.mapcentia.com/js/leaflet/leaflet.js'></script>
	<!--<script src='http://eu1.mapcentia.com/js/openlayers/OpenLayers.js'></script>-->
	<script src='http://us1.mapcentia.com/api/v3/js/geocloud.js'></script>
	<script src="http://maps.stamen.com/js/tile.stamen.js?v1.2.0"></script>
	<script src="http://maps.google.com/maps/api/js?v=3.2&sensor=false"></script>
	<script>
		(function(){
			cloudMap = new geocloud.map({
				el: "map"
			});
			cloudMap.bingApiKey = "AhumC8sixvNikuNE-Nhets6UzaFIE5S_ASO25bGyMUnrtypUTFnG3ZXWxxH3BwrP";

			cloudMap.addBaseLayer(geocloud.OSM);
			cloudMap.addBaseLayer(geocloud.MAPQUESTOSM);
			cloudMap.addBaseLayer(geocloud.MAPBOXNATURALEARTH);
			cloudMap.addBaseLayer(geocloud.STAMENTONER);
			cloudMap.addBaseLayer(geocloud.GOOGLESTREETS);
			cloudMap.addBaseLayer(geocloud.GOOGLEHYBRID);
			cloudMap.addBaseLayer(geocloud.GOOGLESATELLITE);
			cloudMap.addBaseLayer(geocloud.GOOGLETERRAIN);
			cloudMap.addBaseLayer(geocloud.BINGROAD);
			cloudMap.addBaseLayer(geocloud.BINGAERIAL);
			cloudMap.addBaseLayer(geocloud.BINGAERIALWITHLABELS);

			cloudMap.setBaseLayer(geocloud.BINGROAD);

			//cloudMap.zoomToExtent();
			var styleTweets = {
				"color": "#ff00ff",
				"weight": 5,
				"opacity": 0.65
			};


			cloudMap.addTileLayers({
				db: "mh",
				layers: ["public.test"],
				visibility: true
			});

			var store = new geocloud.sqlStore({
				db: "mh",
				sql: "SELECT * FROM test",
				onLoad: function(){
					cloudMap.zoomToExtentOfgeoJsonStore(store);
				}
			});
			var tweetGroups = new L.MarkerClusterGroup({
				maxClusterRadius: 60,
				iconCreateFunction: null,
				spiderfyOnMaxZoom: true,
				showCoverageOnHover: false,
				zoomToBoundsOnClick: true
			});

			var tweet = new geocloud.tweetStore({
				onLoad: function () {
					cloudMap.map.addLayer(tweetGroups);
					cloudMap.zoomToExtentOfgeoJsonStore(tweet);

				},
				q: "geocode=40.751676,-73.982184,3km&count=100",
				onEachFeature: function (feature, layer) {
					layer.bindPopup("<p><a target='_blank' href='https://twitter.com/" + feature.properties.user_screen_name + "'>" + feature.properties.user_name + "</a><br>" + feature.properties.text + "<br><i style='font-size;80%;color:silver'>" + feature.properties.created_at + "</i></p>");
				},
				pointToLayer: function (feature, latlng) {
					var f = L.marker(latlng,
					{icon: L.AwesomeMarkers.icon(
						{ icon: 'icon-twitter', color: 'blue' }
						)}).bindPopup(
					"<p><a target='_blank' href='https://twitter.com/" + feature.properties.user_screen_name + "'>" + feature.properties.user_name + "</a><br>" + feature.properties.text + "<br><i style='font-size;80%;color:silver'>" + feature.properties.created_at + "</i></p>"
					);
					f.martin = {id:feature.properties.id,text:feature.properties.text};
					tweetGroups.addLayer(f);
					return tweetGroups;

				}
			});

			console.log(tweet);
			cloudMap.addGeoJsonStore(tweet);
			tweet.load();
			//store.hide();
		})()
	</script>
</html>
