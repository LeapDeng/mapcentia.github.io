<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <link href="http://eu1.mapcentia.com/js/leaflet/leaflet.css" type="text/css" rel="stylesheet">
    <title>Trackunit</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <style>
        body {
            margin: 0px;
            padding: 0px;
        }

        #map {
            position: absolute;
            width: 100%;
            height: 100%;
        }
        .info {
            width: 200px;
            padding: 6px 8px;
            font: 14px/16px Arial, Helvetica, sans-serif;
            background: white;
            background: rgba(255,255,255,0.8);
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            border-radius: 5px;
        }
        .info h4 {
            margin: 0 0 5px;
            color: #777;
        }
        .leaflet-top {
            left: 20px !important;
            left: auto;
            top: 7px;
            opacity: 0.8;
        }
    </style>
</head>
<body>
<div id="map"></div>
</body>
<script src='http://eu1.mapcentia.com/js/leaflet/leaflet.js'></script>
<script src='http://eu1.mapcentia.com/api/v3/js/geocloud.js'></script>
<script>
    var map = new geocloud.map({el: "map"});
/*    map.addBaseLayer(geocloud.OSM);
    map.setBaseLayer(geocloud.OSM)*/;
    // Create a GeoJSON store
    var store = new geocloud.sqlStore({
        db: "trackunit",
        sql: "SELECT * FROM trackunit.units_view",
        lifetime: 9999999, // Cache the GeoJSON on server
        styleMap: {
            fillColor: 'white',
            weight: 2,
            opacity: 0,
            color: 'white',
            fillOpacity: 0.0
        },
        onEachFeature: function (feature, layer) {
            var me = this;
            layer.on({
                mouseover: function (e) {
                    var layer = e.target;

                    layer.setStyle({
                        weight: 5,
                        color: '#666',
                        dashArray: '',
                        fillOpacity: 0,
                        opacity: 1
                    });

                    if (!L.Browser.ie && !L.Browser.opera) {
                        layer.bringToFront();
                    }
                    info.update(layer.feature.properties);
                },
                mouseout: function (e) {
                    store.resetStyle(e.target);
                    info.update();
                },
                click: function (e) {
                    map.map.fitBounds(e.target.getBounds());
                }
            })
        },
        onLoad: function () {
            // Zoom to vector layer
            map.zoomToExtentOfgeoJsonStore(this);
        }
    }).load().addTo(map.map);

    var layers = map.addTileLayers({
        db: "trackunit",
        layers: ["trackunit.units_view"],
        visibility: true
    });

    // Make info box
    var info = L.control();
    info.onAdd = function () {
        this._div = L.DomUtil.create('div', 'info'); // create a div with a class "info"
        this.update();
        return this._div;
    };
    info.update = function (props) {
        this._div.innerHTML = '<h4>Info</h4>' +  (props ?
                '<b>' + props.komnavn +
                        '</b><br>Run1: ' + props.time +
                        '</b><br>Count: ' + props.count
                : 'Hover over en kommune og klik for at zoome');
    };
    info.addTo(map.map);
</script>
</html>
